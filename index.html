<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'wasm-unsafe-eval';
    connect-src 'self' https: wss:;
    img-src 'self' data: blob:;
    style-src 'self' 'unsafe-inline';
    font-src 'self' data:;
    media-src 'self' blob: mediastream:;
  ">
  <title>CallSteer.ai</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Login Screen -->
  <div class="widget" id="login-screen">
    <!-- Header - Windows Style: Left (empty on login), Center (branding), Right (window controls) -->
    <div class="widget-header" id="login-drag-area">
      <div class="header-left">
        <!-- Empty on login screen -->
      </div>
      <div class="header-center">
        <span class="brand-text"><span class="brand-name">CALLSTEER</span><span class="brand-ai">.AI</span></span>
      </div>
      <div class="header-right">
        <button class="window-control-btn minimize" id="login-minimize-btn" title="Minimize">
          <svg viewBox="0 0 10 10" width="10" height="10">
            <line x1="0" y1="5" x2="10" y2="5" stroke="currentColor" stroke-width="1"/>
          </svg>
        </button>
        <button class="window-control-btn close" id="login-close-btn" title="Close">
          <svg viewBox="0 0 10 10" width="10" height="10">
            <line x1="0" y1="0" x2="10" y2="10" stroke="currentColor" stroke-width="1"/>
            <line x1="10" y1="0" x2="0" y2="10" stroke="currentColor" stroke-width="1"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Login Content -->
    <div class="login-content">
      <div class="logo-container">
        <!-- Navigation Pin / Location Marker -->
        <svg class="logo-svg"  width="56" height="56" viewBox="0 0 253.92 275.48">
          <path d="M237.66,62.15c-.1-.18-.21-.34-.31-.52-7.91-14.97-18.7-27.58-32.46-37.79C185.39,9.39,162.27,1.58,135.61.27c-.57-.03-1.16-.03-1.74-.06-2.1-.08-4.17-.21-6.31-.21-.2,0-.4.02-.6.02-.2,0-.4-.02-.6-.02-2.26,0-4.45.13-6.66.22-.45.02-.9.02-1.35.05-26.68,1.3-49.81,9.05-69.32,23.4-16.25,11.96-28.41,27.3-36.49,45.99C4.18,87.47,0,107.37,0,129.37c0,25.06,5.42,47.34,16.26,66.85.1.18.21.34.31.52,2.9,5.5,6.2,10.68,9.89,15.54l-16.96,63.21,60.36-28.68c14.57,6.66,30.72,10.42,48.45,11.3.57.03,1.16.03,1.74.06,2.1.08,4.17.21,6.31.21.2,0,.4-.02.6-.02.2,0,.4.02.6.02,2.26,0,4.45-.13,6.66-.22.45-.02.9-.02,1.35-.05,26.68-1.3,49.81-9.05,69.32-23.4,16.25-11.96,28.41-27.3,36.49-45.99,8.35-17.82,12.54-37.72,12.54-59.71,0-25.06-5.42-47.34-16.26-66.85Z" fill="#fff"/>
          <path d="M34.86,73.36c9.07-16.42,21.71-29.22,37.94-38.39,16.22-9.17,34.61-13.75,55.17-13.75,25.19,0,46.75,6.65,64.69,19.95,17.93,13.3,29.92,31.44,35.97,54.41h-56.83c-4.23-8.87-10.23-15.61-17.99-20.25-7.76-4.63-16.58-6.95-26.45-6.95-15.92,0-28.82,5.54-38.69,16.62-9.87,11.09-14.81,25.9-14.81,44.44s4.94,33.35,14.81,44.43c9.87,11.09,22.77,16.63,38.69,16.63,9.87,0,18.69-2.31,26.45-6.96,7.76-4.63,13.75-11.38,17.99-20.25h56.83c-6.05,22.97-18.04,41.06-35.97,54.26-17.94,13.2-39.5,19.8-64.69,19.8-20.55,0-38.95-4.58-55.17-13.75-16.22-9.17-28.87-21.92-37.94-38.24-9.07-16.32-13.6-34.96-13.6-55.92s4.53-39.65,13.6-56.07Z" fill="#0a0a0f"/>
        </svg>
      </div>

      <h1 class="brand-title">CallSteer<span class="title-ai">.ai</span></h1>
      <p class="brand-subtitle">Navigate to Close</p>

      <div class="login-form">
        <input
          type="text"
          id="client-code-input"
          class="input-field"
          placeholder="Company code"
          maxlength="6"
          autocomplete="off"
          spellcheck="false"
        />
        <input
          type="text"
          id="rep-id-input"
          class="input-field"
          placeholder="Rep ID (e.g. REP-A1B2C3)"
          maxlength="20"
          autocomplete="off"
          spellcheck="false"
        />
        <input
          type="password"
          id="pin-input"
          class="input-field"
          placeholder="6-digit PIN"
          maxlength="6"
          inputmode="numeric"
          pattern="[0-9]*"
          autocomplete="off"
        />
        <p class="input-hint">Get your Rep ID and PIN from your manager</p>
        <div class="caps-lock-warning" id="caps-lock-warning" style="display: none;">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 9v4M12 17h.01M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
          </svg>
          <span>Caps Lock is on</span>
        </div>
        <div class="login-error" id="login-error"></div>
        <button class="btn btn-primary" id="connect-btn">
          <span class="btn-text">Connect</span>
          <div class="btn-loader" id="login-spinner"></div>
        </button>
      </div>

      <a href="#" class="signup-link" id="signup-link">Get started at callsteer.com</a>
    </div>
  </div>

  <!-- Setup Wizard (Audio Setup) -->
  <div class="widget" id="setup-wizard" style="display: none;">
    <!-- Header - Windows Style: Left (empty on setup), Center (branding), Right (window controls) -->
    <div class="widget-header" id="setup-drag-area">
      <div class="header-left">
        <!-- Empty on setup wizard -->
      </div>
      <div class="header-center">
        <span class="brand-text"><span class="brand-name">CALLSTEER</span><span class="brand-ai">.AI</span></span>
      </div>
      <div class="header-right">
        <button class="window-control-btn minimize" id="setup-minimize-btn" title="Minimize">
          <svg viewBox="0 0 10 10" width="10" height="10">
            <line x1="0" y1="5" x2="10" y2="5" stroke="currentColor" stroke-width="1"/>
          </svg>
        </button>
        <button class="window-control-btn close" id="setup-close-btn" title="Close">
          <svg viewBox="0 0 10 10" width="10" height="10">
            <line x1="0" y1="0" x2="10" y2="10" stroke="currentColor" stroke-width="1"/>
            <line x1="10" y1="0" x2="0" y2="10" stroke="currentColor" stroke-width="1"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Step 1: Microphone Selection -->
    <div class="setup-content" id="setup-step-1">
      <div class="setup-step-indicator">
        <span class="step-badge">Step 1 of 3</span>
      </div>

      <h2 class="setup-title">Select Your Microphone</h2>
      <p class="setup-subtitle">Choose the mic you use for calls</p>

      <!-- Microphone Selection -->
      <div class="setup-section">
        <div class="setup-section-label">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
          </svg>
          Your Microphone
        </div>
        <select id="setup-mic-select" class="setup-select">
          <option value="">Loading microphones...</option>
        </select>
      </div>

      <!-- Mic Test Waveform -->
      <div class="mic-test-section" id="mic-test-section" style="display: none;">
        <div class="mic-test-label">Speak to test your mic</div>
        <div class="mic-waveform" id="mic-waveform">
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
          <div class="waveform-bar"></div>
        </div>
        <div class="mic-test-status" id="mic-test-status">Waiting for audio...</div>
      </div>

      <div class="setup-actions">
        <button class="btn btn-secondary" id="setup-back-btn">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back
        </button>
        <button class="btn btn-primary" id="setup-next-btn" disabled>
          Next
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Step 2: VB-Cable Listen Setup -->
    <div class="setup-content" id="setup-step-2" style="display: none;">
      <div class="setup-step-indicator">
        <span class="step-badge">Step 2 of 3</span>
      </div>

      <h2 class="setup-title">Enable "Listen to this device"</h2>

      <!-- Warning callout -->
      <div class="setup-warning-callout">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <div class="warning-callout-text">
          <strong>Without this step, you won't hear your customers!</strong>
          <span>VB-Cable routes audio silently unless you enable "Listen"</span>
        </div>
      </div>

      <div class="listen-setup-instructions">
        <button class="btn btn-primary listen-setup-btn" id="open-sound-settings-btn">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
          Open Sound Settings
        </button>

        <div class="listen-steps">
          <div class="listen-step">
            <span class="listen-step-number">1</span>
            <div class="listen-step-content">
              <span>Go to <strong>"Recording"</strong> tab</span>
              <span class="listen-step-hint">You'll see a list of audio input devices</span>
            </div>
          </div>
          <div class="listen-step">
            <span class="listen-step-number">2</span>
            <div class="listen-step-content">
              <span>Right-click <strong>"CABLE Output"</strong> → Properties</span>
              <span class="listen-step-hint">This is the VB-Cable virtual device</span>
            </div>
          </div>
          <div class="listen-step">
            <span class="listen-step-number">3</span>
            <div class="listen-step-content">
              <span>Click the <strong>"Listen"</strong> tab</span>
            </div>
          </div>
          <div class="listen-step">
            <span class="listen-step-number">4</span>
            <div class="listen-step-content">
              <span>Check <strong>"Listen to this device"</strong></span>
              <span class="listen-step-hint">This sends audio to your headphones</span>
            </div>
          </div>
          <div class="listen-step">
            <span class="listen-step-number">5</span>
            <div class="listen-step-content">
              <span>Choose your headphones from dropdown, click <strong>Apply</strong></span>
            </div>
          </div>
        </div>
      </div>

      <div class="setup-actions">
        <button class="btn btn-secondary" id="setup-step2-back-btn">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back
        </button>
        <button class="btn btn-ghost" id="setup-skip-listen-btn">
          Skip for now
        </button>
        <button class="btn btn-primary" id="setup-listen-done-btn">
          I've enabled it
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Step 3: Final Instructions Screen -->
    <div class="setup-content" id="setup-step-3" style="display: none;">
      <div class="setup-step-indicator">
        <span class="step-badge">Step 3 of 3</span>
      </div>

      <div class="setup-instructions">
        <div class="instructions-icon success">
          <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
        </div>
        <h2 class="setup-title">You're All Set!</h2>
        <p class="setup-subtitle">CallSteer will listen to your calls and provide real-time coaching.</p>

        <div class="instructions-steps">
          <div class="instruction-step">
            <span class="instruction-number">1</span>
            <span>Click the <strong>power button</strong> to start listening</span>
          </div>
          <div class="instruction-step">
            <span class="instruction-number">2</span>
            <span>Make calls in Zoom, Dialpad, Teams, or any app</span>
          </div>
          <div class="instruction-step">
            <span class="instruction-number">3</span>
            <span>Get instant AI coaching when objections arise</span>
          </div>
        </div>

        <div class="privacy-note">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
          <span>Audio is only captured when the power is ON. Turn it OFF between calls.</span>
        </div>
      </div>

      <div class="setup-actions">
        <button class="btn btn-secondary" id="setup-step3-back-btn">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back
        </button>
        <button class="btn btn-primary" id="setup-done-btn">
          Start Coaching
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Widget -->
  <div class="widget" id="main-widget" style="display: none;">
    <!-- Header - Windows Style: Left (greeting + icons), Center (branding), Right (window controls) -->
    <div class="widget-header" id="drag-area">
      <div class="header-left">
        <span class="user-greeting" id="user-greeting"></span>
        <button class="header-icon-btn" id="dashboard-btn" title="Open Dashboard">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
          </svg>
        </button>
        <button class="header-icon-btn theme-toggle" id="theme-toggle-btn" title="Toggle Light/Dark Mode">
          <!-- Sun icon (shown in dark mode) -->
          <svg class="sun-icon" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <!-- Moon icon (shown in light mode) -->
          <svg class="moon-icon" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
        <div class="settings-menu-container">
          <button class="header-icon-btn" id="settings-btn" title="Settings">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
              <circle cx="12" cy="12" r="3"/>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
          </button>
          <!-- Settings Dropdown Menu -->
          <div class="settings-dropdown" id="settings-dropdown">
            <div class="settings-user-info">
              <span class="settings-user-name" id="settings-rep-name">Rep Name</span>
              <span class="settings-company" id="settings-company-name">Company</span>
            </div>
            <div class="settings-divider"></div>
            <button class="settings-menu-item" id="menu-audio-setup">
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
              </svg>
              Microphone Setup
            </button>
            <button class="settings-menu-item" id="menu-system-audio">
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 18v-6a9 9 0 0 1 18 0v6"/>
                <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/>
              </svg>
              VB-Cable Setup
            </button>
            <button class="settings-menu-item" id="menu-audio-help">
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
              Can't hear calls? Setup Guide
            </button>
            <div class="settings-divider"></div>
            <button class="settings-menu-item toggle-item" id="menu-nudge-sound">
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
              </svg>
              <span class="toggle-item-label">Nudge Sound</span>
              <div class="toggle-switch active" id="nudge-sound-toggle">
                <div class="toggle-switch-slider"></div>
              </div>
            </button>
            <div class="settings-divider"></div>
            <button class="settings-menu-item signout" id="menu-signout">
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
              </svg>
              Sign Out
            </button>
          </div>
        </div>
      </div>
      <div class="header-center">
        <span class="status-indicator" id="header-status"></span>
        <span class="brand-text"><span class="brand-name">CALLSTEER</span><span class="brand-ai">.AI</span></span>
      </div>
      <div class="header-right">
        <button class="window-control-btn minimize" id="minimize-btn" title="Minimize">
          <svg viewBox="0 0 10 10" width="10" height="10">
            <line x1="0" y1="5" x2="10" y2="5" stroke="currentColor" stroke-width="1"/>
          </svg>
        </button>
        <button class="window-control-btn close" id="close-btn" title="Close">
          <svg viewBox="0 0 10 10" width="10" height="10">
            <line x1="0" y1="0" x2="10" y2="10" stroke="currentColor" stroke-width="1"/>
            <line x1="10" y1="0" x2="0" y2="10" stroke="currentColor" stroke-width="1"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="content">
      <!-- Audio Config Display (clickable to open setup wizard) -->
      <div class="section audio-config-section">
        <!-- Your Mic (your voice) -->
        <div class="audio-config-row clickable" id="mic-config-row" title="Click to change microphone">
          <div class="audio-config-icon mic">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
              <line x1="12" y1="19" x2="12" y2="23"/>
              <line x1="8" y1="23" x2="16" y2="23"/>
            </svg>
          </div>
          <div class="audio-config-info">
            <span class="audio-config-label">
              YOUR MIC
              <span class="audio-tooltip" title="Your physical microphone - captures YOUR voice">
                <svg viewBox="0 0 24 24" width="10" height="10" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                  <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
              </span>
            </span>
            <span class="audio-config-value" id="mic-display">Not configured</span>
          </div>
          <span class="audio-config-change">Change</span>
        </div>
        <!-- Hidden select for mic (still needed for getUserMedia) -->
        <select id="mic-select" class="device-select" style="display: none;">
          <option value="">Select mic...</option>
        </select>

        <!-- System Audio (customer's voice) -->
        <div class="audio-config-row" id="system-audio-row">
          <div class="audio-config-icon system-audio">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
              <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
              <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
            </svg>
          </div>
          <div class="audio-config-info">
            <span class="audio-config-label">
              SYSTEM AUDIO
              <span class="audio-tooltip" title="VB-Cable virtual device - captures CUSTOMER'S voice from your dialer">
                <svg viewBox="0 0 24 24" width="10" height="10" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                  <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
              </span>
            </span>
            <span class="audio-config-value system-audio-status" id="system-audio-display">
              <span class="status-dot"></span>
              VB-Cable Ready
            </span>
          </div>
          <a href="#" class="audio-help-link" id="audio-help-link" title="Can't hear your calls? Click for help">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
              <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
          </a>
        </div>
      </div>

      <!-- Audio Warning Banner (shown when listening) -->
      <div class="audio-warning" id="audio-warning" style="display: none;">
        <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
          <line x1="12" y1="9" x2="12" y2="13"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        <span>VB-Cable captures all system audio. Close music/videos for best results.</span>
        <button class="warning-dismiss" id="dismiss-audio-warning">×</button>
      </div>

      <!-- Power Toggle -->
      <div class="section toggle-section">
        <div class="toggle-info">
          <span class="toggle-status" id="toggle-status">OFF</span>
          <span class="toggle-hint" id="toggle-hint">Start listening</span>
        </div>
        <button class="power-btn" id="power-toggle">
          <!-- Simple Power Icon -->
          <svg class="power-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
            <path d="M12 2v10"/>
            <path d="M18.4 6.6a9 9 0 1 1-12.8 0"/>
          </svg>
        </button>
      </div>

      <!-- Listening Indicator -->
      <div class="listening-indicator" id="listening-animation" style="display: none;">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <span class="listening-text">Listening</span>
        <span class="listening-reminder">Turn off between calls</span>
      </div>

      <!-- Tab Navigation -->
      <div class="tab-nav">
        <button class="tab-btn active" data-tab="live">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <circle cx="12" cy="12" r="3" fill="currentColor"/>
          </svg>
          Live
        </button>
        <button class="tab-btn" data-tab="stats">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 20V10M12 20V4M6 20v-6"/>
          </svg>
          Stats
        </button>
      </div>

      <!-- Live Tab (Nudges) -->
      <div class="tab-content active" id="tab-live">
        <!-- Nudge Section -->
        <div class="section nudge-section" id="nudge-section">
          <!-- Empty State -->
          <div class="nudge-empty" id="nudge-empty">
            <p class="empty-text">Ready to navigate</p>
            <p class="empty-hint">Turn on to get AI coaching</p>
          </div>

          <!-- Nudge Card (hidden by default) -->
          <div class="nudge-card" id="nudge-card" style="display: none;">
            <div class="nudge-header">
              <span class="nudge-type" id="nudge-type">TIP</span>
              <span class="nudge-time" id="nudge-time">Just now</span>
            </div>
            <p class="nudge-text" id="nudge-text"></p>
            <div class="nudge-actions">
              <button class="nudge-btn vote-btn" id="vote-up-btn" title="Good suggestion">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/>
                </svg>
              </button>
              <button class="nudge-btn vote-btn" id="vote-down-btn" title="Bad suggestion">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"/>
                </svg>
              </button>
              <div class="nudge-actions-divider"></div>
              <button class="nudge-btn" id="copy-nudge-btn" title="Copy">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2"/>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                </svg>
              </button>
              <button class="nudge-btn" id="dismiss-nudge-btn" title="Dismiss">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Quick Stats Bar -->
        <div class="section stats-section">
          <div class="stat">
            <span class="stat-value" id="stat-rebuttals">0</span>
            <span class="stat-label">Used</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat">
            <span class="stat-value" id="stat-adoption">0%</span>
            <span class="stat-label">Adoption</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat">
            <span class="stat-value" id="stat-nudges">0</span>
            <span class="stat-label">Today</span>
          </div>
        </div>
      </div>

      <!-- Stats Tab (Gamification) -->
      <div class="tab-content" id="tab-stats">
        <!-- Profile Header -->
        <div class="stats-profile">
          <div class="profile-info">
            <span class="profile-name" id="stats-rep-name">Rep Name</span>
            <span class="profile-company" id="stats-company-name">Company</span>
          </div>
          <div class="profile-rank" id="stats-rank-badge">
            <span class="rank-number">#-</span>
          </div>
        </div>

        <!-- Today's Performance -->
        <div class="stats-hero">
          <div class="stats-hero-value" id="stats-adoption-big">0%</div>
          <div class="stats-hero-label">Adoption Rate</div>
          <div class="stats-hero-subtitle">Today's Performance</div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stats-card">
            <div class="stats-card-icon used">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </div>
            <div class="stats-card-info">
              <span class="stats-card-value" id="stats-used-today">0</span>
              <span class="stats-card-label">Rebuttals Used</span>
            </div>
          </div>

          <div class="stats-card">
            <div class="stats-card-icon received">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              </svg>
            </div>
            <div class="stats-card-info">
              <span class="stats-card-value" id="stats-received-today">0</span>
              <span class="stats-card-label">Nudges Received</span>
            </div>
          </div>

          <div class="stats-card">
            <div class="stats-card-icon streak">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
              </svg>
            </div>
            <div class="stats-card-info">
              <span class="stats-card-value" id="stats-streak">0</span>
              <span class="stats-card-label">Current Streak</span>
            </div>
          </div>

          <div class="stats-card">
            <div class="stats-card-icon best">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
            </div>
            <div class="stats-card-info">
              <span class="stats-card-value" id="stats-best-streak">0</span>
              <span class="stats-card-label">Best Streak</span>
            </div>
          </div>
        </div>

        <!-- Leaderboard -->
        <div class="leaderboard-section">
          <div class="leaderboard-header">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M8 21h8m-4-4v4m-5-8l5-10 5 10M4 13h16"/>
            </svg>
            <span>Team Ranking</span>
            <div class="leaderboard-column-labels">
              <span class="col-label">Rate</span>
              <span class="col-label">Used</span>
            </div>
          </div>
          <div class="leaderboard-list" id="leaderboard-list">
            <div class="leaderboard-empty">Loading rankings...</div>
          </div>
        </div>

        <!-- Motivation Message -->
        <div class="stats-motivation" id="stats-motivation">
          <span class="motivation-emoji"></span>
          <span class="motivation-text">Start using rebuttals to build your streak!</span>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer" id="connection-status">
      <span class="footer-dot"></span>
      <span class="footer-text" id="status-text">Connecting...</span>
    </div>

    <!-- Resize handles are now created dynamically by JavaScript (setupGlobalResizeHandles) -->
    <!-- They are appended to body so they work on ALL screens (login, setup, main widget) -->
  </div>

  <!-- Nudge Popup Container (for mini mode) -->
  <div id="nudge-popup-container"></div>

  <!-- Call App Picker Modal -->
  <div class="picker-overlay" id="call-app-picker" style="display: none;">
    <div class="picker-modal">
      <div class="picker-header">
        <h3 class="picker-title">Select Your Call App</h3>
        <p class="picker-subtitle">Choose the app you're using for this call</p>
      </div>

      <div class="picker-content">
        <!-- Detected Call Apps -->
        <div class="picker-section" id="picker-call-apps">
          <div class="picker-section-label">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
            Detected Call Apps
          </div>
          <div class="picker-grid" id="picker-call-apps-grid">
            <!-- Dynamically populated -->
          </div>
        </div>

        <!-- Browser Tabs & Other Apps -->
        <div class="picker-section" id="picker-other-windows">
          <div class="picker-section-label">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <path d="M3 9h18"/>
            </svg>
            Browser Tabs & Other Apps
          </div>
          <div class="picker-grid" id="picker-other-grid">
            <!-- Dynamically populated -->
          </div>
        </div>

        <!-- System Audio Option -->
        <div class="picker-section">
          <div class="picker-section-label">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
              <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
              <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
            </svg>
            Capture All Audio
          </div>
          <div class="picker-grid">
            <div class="picker-item" data-source-id="system-audio" data-source-name="All System Audio">
              <div class="picker-item-icon system">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <rect x="4" y="4" width="16" height="12" rx="2"/>
                  <path d="M8 20h8"/>
                  <path d="M12 16v4"/>
                </svg>
              </div>
              <span class="picker-item-name">All System Audio</span>
              <span class="picker-item-hint">Captures audio from all apps</span>
            </div>
          </div>
        </div>
      </div>

      <div class="picker-footer">
        <button class="btn btn-secondary" id="picker-cancel-btn">Cancel</button>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
